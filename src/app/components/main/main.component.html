<div class="background-container">
  <app-navbar></app-navbar>
  <div class="custom-form">
    <div class="my-form">
      <div class="form-group">
        <div class="container">
          <div
            class="row header"
            style="justify-content: center; align-items: center"
          >
            <div class="col-md-1">
              <i
                class="fa-solid fa-bag-shopping"
                style="
                  padding: 10px;
                  color: #fff;
                  background-color: #001a72;
                  border-radius: 50%;
                "
              ></i>
            </div>
            <h3 class="col-md-11 padding-center">الصف</h3>
          </div>
        </div>

        <div class="row payment-methods">
          <div class="col-md-1 custom-box-2">
            <div class="container" (click)="prevItemsGrades()">
              <div class="row">
                <i class="fa-solid fa-angle-left"></i>
              </div>
            </div>
          </div>
          <!-- (click)="getSubjectByGradeId(grad.id); toggleStyleGeneric($event, grad.id, 'grade')" -->
          <!-- Dynamic Subject Cards -->
          <div
            class="col-md-3 custom-box grade-box"
            *ngFor="let grade of visibleGrades"
            (click)="
              toggleStyleGeneric($event, grade.id, 'grade');
              getSubjectByGradeId(grade.id);
              onGradeClick(grade)
            "
          >
            <div class="container">
              <div class="row">
                <h6>{{ grade.gradeName }}</h6>
              </div>
            </div>
          </div>

          <div class="col-md-1 custom-box-2">
            <div class="container" (click)="nextItemsGrade()">
              <div class="row">
                <i class="fa-solid fa-angle-right"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="container">
          <div
            class="row header"
            style="justify-content: center; align-items: center"
          >
            <div class="col-md-1">
              <i
                class="fa-solid fa-bag-shopping"
                style="
                  padding: 10px;
                  color: #fff;
                  background-color: #001a72;
                  border-radius: 50%;
                "
              ></i>
            </div>
            <h3 class="col-md-11 padding-center">الماده</h3>
          </div>
        </div>

        <div class="row payment-methods">
          <div class="col-md-1 custom-box-2">
            <div class="container" (click)="prevItems()">
              <div class="row">
                <i class="fa-solid fa-angle-left"></i>
              </div>
            </div>
          </div>

          <!-- Dynamic Subject Cards -->
          <div
            class="col-md-3 custom-box subject-box"
            *ngFor="let subject of visibleSubjects"
            (click)="
              toggleStyleGeneric($event, subject.subjectId, 'subject');
              onSubjectClick(subject.subjectId)
            "
          >
            <div class="container">
              <div class="row">
                <h6>{{ subject.subjectName }}</h6>
              </div>
            </div>
          </div>

          <div class="col-md-1 custom-box-2">
            <div class="container" (click)="nextItems()">
              <div class="row">
                <i class="fa-solid fa-angle-right"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="container">
          <div
            class="row header"
            style="justify-content: center; align-items: center"
          >
            <div class="col-md-1" routerLink="/class">
              <i
                class="fa-solid fa-plus"
                style="
                  padding: 10px;
                  color: #fff;
                  background-color: #001a72;
                  border-radius: 50%;
                "
              ></i>
            </div>
            <h3 class="col-md-11 padding-center">الفصل</h3>
          </div>
        </div>

        <div class="row payment-methods">
          <div class="col-md-1 custom-box-2" (click)="preItemClasses()">
            <div class="container">
              <div class="row">
                <i class="fa-solid fa-angle-left"></i>
              </div>
            </div>
          </div>

          <div
            class="col-md-3 custom-box-2"
            *ngFor="let class of visibleClasses"
            (click)="
              onClassClick(class.id, class.classsName); activeClassId = class.id
            "
          >
            <div class="container">
              <div class="row">
                <h6
                  [ngClass]="{
                    'custom-box-text': activeClassId !== class.id,
                    'custom-box-text-active': activeClassId === class.id
                  }"
                >
                  {{ class.classsName }}
                </h6>
                <!-- Display className here -->
              </div>
            </div>
          </div>

          <!-- <div class="col-md-3 custom-box-2" >
            <div class="container" >
              <div class="row">
                <h6 class="custom-box-text">2</h6>
              </div>
            </div>
          </div> -->

          <!-- <div class="col-md-3 custom-box-2" >
            <div class="container">
              <div class="row">
                <h6 class="custom-box-text">1</h6>
              </div>
            </div>
          </div> -->
          <div class="col-md-1 custom-box-2" (click)="nextItemsClasses()">
            <div class="container">
              <div class="row">
                <i class="fa-solid fa-angle-right"></i>
              </div>
            </div>
          </div>
        </div>

        <div
          class="row header"
          style="justify-content: center; align-items: center"
        >
          <div style="display: flex; justify-content: space-between">
            <div class="col-md-1">
              <div>
                <button
                  class="own-btn2"
                  width="100%"
                  (click)="checkLessonId()"
                >
                  تعديل
                </button>
              </div>
            </div>
            <h3 class="col-md-10" >الدرس</h3>

            <div class="col-md-1" data-bs-toggle="modal" data-bs-target="#Edit">
              <i
                class="fa-solid fa-plus"
                style="
                  padding: 10px;
                  color: #fff;
                  background-color: #001a72;
                  border-radius: 50%;
                "
              ></i>
            </div>
          </div>
        </div>

        <div class="row payment-methods2">
          <div class="col-md-1 custom-box-2" (click)="prevItemLessons()">
            <div class="container">
              <div class="row">
                <i class="fa-solid fa-angle-left"></i>
              </div>
            </div>
          </div>

          <div
            class="col-md-3 custom-box lesson-box"
            *ngFor="let test of visibleLessons"
            [ngStyle]="{
              backgroundColor:
                activeLessonId === test.lessonId ? '#001A72' : '#ffff',
              color: activeLessonId === test.lessonId ? '#ffff' : '#001A72'
            }"
            (click)="
              onLessonClick(test.lessonId);
              saveLessonName(test.lessonName);
              activeLessonId = test.lessonId
            "
          >
            <div class="container">
              <div class="row">
                <h6>
                  {{ test.lessonName }}
                </h6>
              </div>
            </div>
          </div>

          <div class="col-md-1 custom-box-2" (click)="nextItemsLesson()">
            <div class="container">
              <div class="row">
                <i class="fa-solid fa-angle-right"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="div-button">
          <button class="own-btn" (click)="submitSelection()">عرض</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Modal -->

<!-- Add Modal -->
<div
  class="modal fade modal-display"
  id="Edit"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="staticBackdropLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content outer-container">
      <div class="inner-container">
        <!-- Modal Header -->
        <div class="modal-header">
          <input
            type="text"
            [(ngModel)]="lessonName"
            class="lesson-title"
            placeholder="الدرس الاول : الدوله الامويه"
          />
          <button
            type="button"
            class="close closebtn"
            data-bs-dismiss="modal"
            aria-label="Close"
          >
            <img src="../../../assets/images/close.png" width="40px" />
          </button>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">
          <div class="full-width-box custom-full-width-grid">
            <div class="custom-card-wrapper" *ngFor="let card of cards; let index = index">
              <div class="custom-card" [ngClass]="{ 'hide-card': hiddenCards[index] }" >
                <div class="custom-card-body">
                  <h5 class="custom-card-title" (click)="openEditFileInput(index)">{{ card.title }}</h5>
        
                  <!-- Display Multiple Images -->
                  <div *ngFor="let img of editUploadedImages[index]; let fileIndex = index">
                    <img [src]="img" alt="Uploaded Image" class="thumbnail-image" />
                    <button class="btn btn-danger px-2 py-1" (click)="removeFile(index, fileIndex, 'image')">x</button>
                  </div>
        
                  <!-- Display Multiple Files -->
                  <ul *ngIf="editUploadedFiles[index] && editUploadedFiles[index].length > 0">
                    <li *ngFor="let file of editUploadedFiles[index]; let fileIndex = index">
                      {{ file.name }}
                      <button class="btn btn-danger px-2 py-1" (click)="removeFile(index, fileIndex, 'file')">x</button>
                    </li>
                  </ul>
        
                  <!-- Hidden File Input -->
                  <input
                    type="file"
                    #fileInput
                    multiple
                    style="display: none"
                    (change)="onEditFileSelected($event, index)"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        
        
        <!-- Modal Footer -->
        <div class="modal-footer">
          <button
            type="submit"
            class="btn custombtn ms-4"
            (click)="onSubmitLesson()"
          >
            حفظ
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div
  class="modal fade"
  id="Edit2"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="staticBackdropLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content outer-container">
      <div class="inner-container">
        <!-- Modal Header -->
        <div class="modal-header">
          <h6 style="color: white; font-size: larger">{{ LessonNameView }}</h6>
          <button
            type="button"
            class="close closebtn"
            data-bs-dismiss="modal"
            aria-label="Close"
          >
            <img src="../../../assets/images/close.png" width="40px" />
          </button>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">
          <div class="full-width-box custom-full-width-grid">
            <div
              class="custom-card-wrapper"
              *ngFor="let resource of lessonResources; let index = index"
            >
              <div
                class="custom-card"
                [ngClass]="{ 'hide-card': !resource.id }"
              >
                <i
                  class="fa-solid fa-times custom-close-icon"
                  *ngIf="resource.id"
                  (click)="
                    deleteResource(resource.id); $event.stopPropagation()
                  "
                ></i>
                <div
                  class="custom-card-body"
                  (click)="openEdit2FileInput(index)"
                >
                  <img
                    *ngIf="
                      resource.resourceType.includes('.jpeg') ||
                      resource.resourceType.includes('.jpg') ||
                      resource.resourceType.includes('.png')
                    "
                    [src]="getResourcePath(resource.resource)"
                    alt="Uploaded Image"
                    class="thumbnail-image"
                  />
                  <i
                    *ngIf="
                      !resource.resourceType.includes('.jpeg') &&
                      !resource.resourceType.includes('.jpg') &&
                      !resource.resourceType.includes('.png')
                    "
                    class="fa {{
                      getFileTypeIcon(resource.resourceType)
                    }} fa-2x"
                  ></i>
                  <p
                    *ngIf="
                      !resource.resourceType.includes('.jpeg') &&
                      !resource.resourceType.includes('.jpg') &&
                      !resource.resourceType.includes('.png')
                    "
                  >
                    File: {{ resource.fileName }}
                  </p>
                </div>
                <input
                  type="file"
                  #edit2FileInput
                  style="display: none"
                  (change)="onEdit2FileSelected($event, index)"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Footer -->
        <div class="modal-footer">
          <button type="submit" class="btn custombtn ms-4">حفظ</button>
        </div>
      </div>
    </div>
  </div>
</div>
